package cz.wrent.advent.day6

fun main() {
    println(findVisitedPlaces(input))
    println(findObstacleOptions(input))
}

fun findVisitedPlaces(input: String): Int {
    val map = input.split("\n").map { it.split("").filterNot { it.isEmpty() } }

    val row = map.indexOfFirst { it.contains("^") }
    val col = map[row].indexOf("^")

    val visited = extracted(row, col, map)
    return visited.size
}

private fun extracted(
    row: Int,
    col: Int,
    map: List<List<String>>
): MutableSet<Pair<Int, Int>> {
    val visited = mutableSetOf<Pair<Int, Int>>()
    var direction = Direction.UP

    var currentRow = row
    var currentCol = col

    while (true) {
        visited.add(Pair(currentRow, currentCol))
        val next = when (direction) {
            Direction.UP -> Pair(currentRow - 1, currentCol)
            Direction.DOWN -> Pair(currentRow + 1, currentCol)
            Direction.LEFT -> Pair(currentRow, currentCol - 1)
            Direction.RIGHT -> Pair(currentRow, currentCol + 1)
        }
        if (next.first < 0 || next.first >= map.size || next.second < 0 || next.second >= map[next.first].size) {
            break
        }
        val nextSymbol = map[next.first][next.second]
        if (nextSymbol == "#") {
            direction = when (direction) {
                Direction.UP -> Direction.RIGHT
                Direction.DOWN -> Direction.LEFT
                Direction.LEFT -> Direction.UP
                Direction.RIGHT -> Direction.DOWN
            }
            continue
        }
        currentRow = next.first
        currentCol = next.second
    }
    return visited
}

fun findObstacleOptions(input: String): Int {
    val map = input.split("\n").map { it.split("").filterNot { it.isEmpty() } }

    val row = map.indexOfFirst { it.contains("^") }
    val col = map[row].indexOf("^")

    val possibleOptions = extracted(row, col, map) - Pair(row, col)

    return possibleOptions.map { (r, c) ->
        val newMap = map.map { it.toMutableList() }.toMutableList()
        newMap[r][c] = "O"
        // println(newMap.joinToString("\n") { it.joinToString("") })
        val findPositionsOrEnd = findPositionsOrEnd(row, col, newMap)
        // println(findPositionsOrEnd)
        // println()
        findPositionsOrEnd
    }.count { it == -1 }
}

private fun findPositionsOrEnd(
    row: Int,
    col: Int,
    map: List<List<String>>
): Int {
    val visited = mutableSetOf<Pair<Direction, Pair<Int, Int>>>()
    var direction = Direction.UP

    var currentRow = row
    var currentCol = col

    while (true) {
        val location = direction to Pair(currentRow, currentCol)
        if (visited.contains(location)) {
            return -1
        }
        visited.add(location)
        val next = when (direction) {
            Direction.UP -> Pair(currentRow - 1, currentCol)
            Direction.DOWN -> Pair(currentRow + 1, currentCol)
            Direction.LEFT -> Pair(currentRow, currentCol - 1)
            Direction.RIGHT -> Pair(currentRow, currentCol + 1)
        }
        if (next.first < 0 || next.first >= map.size || next.second < 0 || next.second >= map[next.first].size) {
            break
        }
        val nextSymbol = map[next.first][next.second]
        // println("$currentRow $currentCol $nextSymbol")
        if (nextSymbol == "#" || nextSymbol == "O") {
            direction = when (direction) {
                Direction.UP -> Direction.RIGHT
                Direction.DOWN -> Direction.LEFT
                Direction.LEFT -> Direction.UP
                Direction.RIGHT -> Direction.DOWN
            }
            continue
        }
        currentRow = next.first
        currentCol = next.second
    }
    // println(visited)
    return visited.map { it.second }.toSet().size
}

enum class Direction {
    UP, DOWN, LEFT, RIGHT
}

// ....#.....
// .........#
// ..........
// ..#.......
// .......#..
// ..........
// .#..^.....
// ........#.
// #.........
// ......#...

private val input =
    """..........................#.#........................................#..........................................#.............#...
....................#...............................#.......#...............................#..........................#...#......
.....#.......#...................................................#..#....................##.........#...#...........#.....#..#.#..
............#...#....#..............##...#.#....#........................#...................................................#....
....#......##........................................................................#..#..##...................##.........#......
.............##.........#..##..............#...............#....................#..................#......#...................#...
...........#.....................#.......#.................#....#.#..............#...........#.........................#..........
.#............#..............................................................#........#................#........#.................
..........................#..#.......................................................#.........#..................................
.........#....#................#...........#...................##............#..........#.........................................
....#...................................#....#.........#..........#.......................#..............................#........
.............................#.....##.............................................................#..#...........................#
....#................#...#.#..........#.#....#..................#..........#......#.............................#.................
......................#............#......................................##................#..........#..#.............#.........
..#........#............#.....###....##...........................#..............................#.....#..........................
.....#...........#..#.........#...................#.#.................#........#............#.....#........#......................
..........................................................................................................................#.......
..#...................#.....................................................................#....................#................
...............#............................#....#..........#...................#............#...............#..#.................
................#...........................#...........................................#.........................#...............
..........#.......#.........................##.................................................#...................##..#..........
.#.........#...#..#............................................#........................#.......................................#.
........#...........###..................#...........#..............#.....................#................#......................
.............#....#............................#.#..............................#..#................................#.............
...#.....#..........#...........#..................................................#........#...........#..#..........##.....#....
...............................................................................#...................#........................##....
......#.#...........................#.................#.................................................................#.........
..................................#............................................................................#.#................
........................#.......#.....#..........#..#.............##.................#..............#............##...............
......#........................#........................................#......#..................................................
...............##.......#..............................................................................................#..........
....#...................................................................................#.........#..........#..............#.....
.....#.............#.........................#.........#........#................#.#.........................#..........#.........
.............#......##...........#................#...#.#.....#......................................#..........#.................
...........................#............#................#................#...........................#.....#.....................
.......#.................#..#..............#................................#....#........#.......#.............#....#....##......
........................................................#........................................................................#
.................#.........................................#.......#.......#......#...#.#.................##......................
..........#............#..............................................#........................................#..........#..#....
..............#......................................................#......#................................#....................
...#........#.............#.................#......#.......................#..............................##........#.............
.....................#............................................................#............#...............................#..
......#.....#..............................................................#...............#...#..................................
.......................................#..#.......#...#..............#.................................................#..........
...................................................................................................#........................#.....
....#.....#.......................................................#.....#......#...................#............#.................
..............#....#.....................#........................................##....#...#.....................................
.....#...............................................................#............#............................#..................
........................#..........................#..............................................................................
#..............#...........................................................................#......................................
...................................#...#....................................................................#.....................
................#......#.........#.................#...........................#..................................................
......#...#................#...............#..................................................#...................................
.......................#.............#..#....................#............#.......................................................
.....................#.#.....................................#................................##.............#.#..#..............#
.....................................#...#...........................#....................................................##...#..
.................#..#............#.............................#..#................................................##.............
...#...........................................#.................................................#.............#.............##...
..................#....#....#.#..........................#.............#................#............................#............
.........................#................#.#..#.#............^.........................................................#.........
.....#...............#............................................................................................................
.#.......................................................................................#...............#....#.............#.....
......#................................#............#............................................................#................
.#.....................#..............#.............#.......................#.....#....#.#.#...................#....#.............
..................................................................#........#............................#..#.#...............#....
.#.....................#......#........#.......#.................#.......................#..#.....................................
..............#..#..#.............................................#....................#......#...................................
.................##.#............................##..#...............................................................#....#.......
...........#..#........................#.#..........#.................##.....#...#.........................#.#...#............#...
.....................#..........#..#..............................................................................................
.......#...............................#..#.........#.....................................#......#...................#............
..............................##.#........#.......#..#.....#......................................................................
..................#......................#.....................................###...#............................##..............
...................................#...................................#...........................#....##..#.....................
.....................#.....#.#.........#.........................#.....#.......#..........#.......................#...............
...........#..................................................................................................#...................
......#............................#.............................#..........................................#.....##..............
...........................#...........................................................#.............................#..........#.
..........................................#..........................................#......#...............#.....................
..............##.........#........................................................................................................
.....................#............#..#......#..#......................................................................#...........
........#.........#.....................#.................................#...#.#....#....#......................#.#..............
......#...........#............................................................#..............#......................#............
.....#.....................#.....#.........#.............................#....#............................#......................
..#..............................................................................................................#...#............
..............#.......................#........#............................................#.......................#.............
........................................#....................................................................................##...
.......#..#.......#.................#.#.................#...........#............#........#.#.........#...........#.#..........#..
.....##.......................#.........................#.........................#...........#.........#.....#...........#.......
..........................#.....................#...............................#.............................#...................
.....#..........#.............#...#..........................#.#...................#...........................#......#...........
......................................#.......#.........#......................................#..................................
......#...#....................#................#...#.......#.............#............#...........#.....#........................
........................................#............#......................................................#............#........
..#.......#....#..........................................................................#......................##..#.......#....
................#...................................................#..........................................#..................
...........#........................................................................................#.............................
..................#........................................#.....#...........................#..................#.................
........#.......#.....#...........#.......................................................#.........#.............................
.............#.....#.#............................#...................................................................#...........
...............#...................................#...........................#.............#..#..................#..##..........
.#...............................#....#.....................#...................................#...................#...#.........
..................#..#.#..................................................................................................#.......
.........#.....#...#.........#........#...........................................#..................#.#.#......#.................
.........#......#.......................#........#.............................#...#................#...........................#.
...#.........................................................................................##........................#..........
.....................................#...........................................................#.#...#......#...............#...
#.....................#.........#.................................................#.....................................#.........
............##.............................#...............................................#......................................
.#.................#........................#.................................................................#.....#.............
.....#.......................#......................#.................#....#....................................................#.
.............................#..................................................................#.#...............................
........#.......#.....##..........................................#...................#.........#...........#...#...#...#.........
..........#.#...#.....................#............................................................##.........##..................
...................#..............##.....#...........#.#.......#................................................#...............#.
............................................................#....#.............#....##.......#...#...#................#...........
......#...............................#.........#...................#....#..............#.................#.......................
....................................#.....................#....#....#.................#...............#...........................
.................................#.............#.#...................................#..............#...#.....#.............#.....
......................#..................#.............#.................#................................................#.......
.....................##.......................#.............#...#........#..........#.....#............................##...#.....
..........................#.....................#...........#.....................................................#...............
................#.....................................................................................................#...........
........#......#.......................#....................................#................................#....................
.....................................#............................................................................................
........#..........#.........#.#................##................#...#..........................#.........#......##.......#......
.......#...................#................................#..#.......................#..............................#...........
............#.....................................#......#........................#..........#.............................#......
..#...........#...........#...................................#............#...#.....#......................................#.....
................................................................#...........#.......##.......#..........#............#............""".trimIndent()
